<template>
  <div>
    <div class="flex justify-between items-end mb-12">
      <BasePageTitle title="Decks" />
      <BaseButton title="Create new deck" @on-clicked="addNewDeck()" />
    </div>

    <transition-group
      v-if="isDecksLoaded"
      enter-active-class="animate__animated animate__tada"
      leave-active-class="animate__animated animate__fadeOutUp"
      class="grid grid-cols-3 gap-12"
    >
      <div v-for="deck in decks" :key="deck.id">
        <router-link
          :to="{
            name: 'PageDeckCards',
            params: { deckId: deck.id },
            query: { t: deck.title },
          }"
        >
          <CardDeck :title="deck.title" />
        </router-link>
      </div>
    </transition-group>

    <div v-else>Loading decks ...</div>
  </div>
</template>

<script>
import Vuex from "vuex";
import CardDeck from "@/components/CardDeck.vue";
import BaseButton from "@/components/BaseButton.vue";
import BasePageTitle from "@/components/BasePageTitle.vue";

export default {
  components: {
    CardDeck,
    BaseButton,
    BasePageTitle
  },
  computed: {
    ...Vuex.mapGetters({
      isDecksLoaded: "getIsDecksLoaded",
      decks: "getDecks",
    }),
  },
  created() {
    if (this.decks.length === 0) {
      this.loadDecks();
    }
    this.resetDeckCards();
  },
  methods: {
    ...Vuex.mapActions(["loadDecks", "createDeck", "resetDeckCards"]),

    addNewDeck() {
      this.$buefy.dialog.prompt({
        title: "Create New Deck",
        message: `Title of the deck`,
        inputAttrs: {
          placeholder: "e.g. Web development",
          maxlength: 20,
        },
        trapFocus: true,
        onConfirm: async (title) => {
          await this.createDeck({ title });
        },
      });
    },
  },
};
</script>
